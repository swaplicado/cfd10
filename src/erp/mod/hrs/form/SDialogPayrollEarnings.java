/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package erp.mod.hrs.form;

import erp.mod.SModConsts;
import erp.mod.hrs.db.SDbEarning;
import erp.mod.hrs.db.SDbPayrollReceiptEarning;
import erp.mod.hrs.db.SHrsEmployeeDays;
import erp.mod.hrs.db.SHrsPayroll;
import erp.mod.hrs.db.SHrsReceipt;
import erp.mod.hrs.db.SHrsReceiptEarning;
import java.awt.BorderLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.ItemEvent;
import java.awt.event.ItemListener;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Vector;
import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JOptionPane;
import javax.swing.event.CellEditorListener;
import javax.swing.event.ChangeEvent;
import sa.lib.SLibConsts;
import sa.lib.SLibUtils;
import sa.lib.db.SDbRegistry;
import sa.lib.grid.SGridColumnForm;
import sa.lib.grid.SGridConsts;
import sa.lib.grid.SGridPaneForm;
import sa.lib.grid.SGridPaneFormOwner;
import sa.lib.grid.SGridRow;
import sa.lib.gui.SGuiClient;
import sa.lib.gui.SGuiConsts;
import sa.lib.gui.SGuiItem;
import sa.lib.gui.SGuiUtils;
import sa.lib.gui.SGuiValidation;
import sa.lib.gui.bean.SBeanFormDialog;

/**
 *
 * @author Juan Barajas, Sergio Flores
 */
public class SDialogPayrollEarnings extends SBeanFormDialog implements SGridPaneFormOwner, ItemListener, ActionListener, CellEditorListener {

    protected static final int COL_UNITS_ALLEGED = 1;
    protected static final int COL_AMOUNT = 4;
    protected static final int COL_SET_FLAG = 7;
    
    protected SHrsPayroll moHrsPayroll;
    protected ArrayList<SHrsReceipt> maHrsReceipts;
    protected HashMap<Integer, SDbEarning> moEarnigsMap;
    protected SGridPaneForm moGridEmployeeRow;

    /**
     * Creates new form SDialogPayrollEarnings
     * @param client
     * @param title
     */
    public SDialogPayrollEarnings(SGuiClient client, String title) {
        setFormSettings(client, SGuiConsts.BEAN_FORM_EDIT, SModConsts.HRSX_PAY_REC_EAR, SLibConsts.UNDEFINED, title);
        initComponents();
        initComponentsCustom();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jPanel12 = new javax.swing.JPanel();
        jlEarning = new javax.swing.JLabel();
        moKeyEarning = new sa.lib.gui.bean.SBeanFieldKey();
        jpEmployee = new javax.swing.JPanel();
        jPanel4 = new javax.swing.JPanel();
        jPanel2 = new javax.swing.JPanel();
        jlValue = new javax.swing.JLabel();
        moCompValue = new sa.lib.gui.bean.SBeanCompoundField();
        jbAdd = new javax.swing.JButton();
        jPanel3 = new javax.swing.JPanel();
        jbClean = new javax.swing.JButton();
        jbCleanAll = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);

        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder("Datos del registro:"));
        jPanel1.setLayout(new java.awt.BorderLayout());

        jPanel12.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEADING, 5, 0));

        jlEarning.setText("Percepción:");
        jlEarning.setPreferredSize(new java.awt.Dimension(75, 23));
        jPanel12.add(jlEarning);

        moKeyEarning.setPreferredSize(new java.awt.Dimension(250, 23));
        jPanel12.add(moKeyEarning);

        jPanel1.add(jPanel12, java.awt.BorderLayout.NORTH);

        jpEmployee.setLayout(new java.awt.BorderLayout());

        jPanel4.setLayout(new java.awt.BorderLayout());

        jPanel2.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT));

        jlValue.setText("Valor:");
        jlValue.setPreferredSize(new java.awt.Dimension(75, 23));
        jPanel2.add(jlValue);

        moCompValue.setPreferredSize(new java.awt.Dimension(125, 23));
        jPanel2.add(moCompValue);

        jbAdd.setText("Agregar");
        jPanel2.add(jbAdd);

        jPanel4.add(jPanel2, java.awt.BorderLayout.WEST);

        jPanel3.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.RIGHT));

        jbClean.setText("Limpiar");
        jbClean.setMargin(new java.awt.Insets(2, 0, 2, 0));
        jbClean.setPreferredSize(new java.awt.Dimension(75, 23));
        jPanel3.add(jbClean);

        jbCleanAll.setText("Limpiar todo");
        jbCleanAll.setMargin(new java.awt.Insets(2, 0, 2, 0));
        jbCleanAll.setPreferredSize(new java.awt.Dimension(75, 23));
        jPanel3.add(jbCleanAll);

        jPanel4.add(jPanel3, java.awt.BorderLayout.EAST);

        jpEmployee.add(jPanel4, java.awt.BorderLayout.NORTH);

        jPanel1.add(jpEmployee, java.awt.BorderLayout.CENTER);

        getContentPane().add(jPanel1, java.awt.BorderLayout.CENTER);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel12;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JButton jbAdd;
    private javax.swing.JButton jbClean;
    private javax.swing.JButton jbCleanAll;
    private javax.swing.JLabel jlEarning;
    private javax.swing.JLabel jlValue;
    private javax.swing.JPanel jpEmployee;
    private sa.lib.gui.bean.SBeanCompoundField moCompValue;
    private sa.lib.gui.bean.SBeanFieldKey moKeyEarning;
    // End of variables declaration//GEN-END:variables

    private void initComponentsCustom() {
        SGuiUtils.setWindowBounds(this, 560, 350);
        
        jbSave.setText("Aceptar");

        moKeyEarning.setKeySettings(miClient, SGuiUtils.getLabelName(jlEarning.getText()), false);
        moCompValue.setCompoundFieldSettings(miClient);
        moCompValue.getField().setDecimalSettings(SGuiUtils.getLabelName(jlValue), SGuiConsts.GUI_TYPE_DEC_QTY, false);
        moCompValue.getField().setNextButton(jbAdd);
        moCompValue.setCompoundText("");
        
        moFields.addField(moKeyEarning);
        
        moFields.setFormButton(jbSave);
        
        moGridEmployeeRow = new SGridPaneForm(miClient, SModConsts.HRSX_PAY_REC_EAR, SLibConsts.UNDEFINED, "Empleados") {
            @Override
            public void initGrid() {
                setRowButtonsEnabled(false, false, false);
            }

            @Override
            public ArrayList<SGridColumnForm> createGridColumns() {
                SGridColumnForm columnForm;
                ArrayList<SGridColumnForm> gridColumnsForm = new ArrayList<>();

                gridColumnsForm.add(new SGridColumnForm(SGridConsts.COL_TYPE_TEXT_NAME_BPR_S, "Empleado"));
                columnForm = new SGridColumnForm(SGridConsts.COL_TYPE_DEC_QTY, "Valor", 50);
                columnForm.setEditable(true);
                gridColumnsForm.add(columnForm);
                gridColumnsForm.add(new SGridColumnForm(SGridConsts.COL_TYPE_TEXT_CODE_UNT, "Unidad", 45));
                columnForm = new SGridColumnForm(SGridConsts.COL_TYPE_DEC_AMT_UNIT, "Monto unitario $", 100);
                columnForm.setEditable(true);
                gridColumnsForm.add(columnForm);
                gridColumnsForm.add(new SGridColumnForm(SGridConsts.COL_TYPE_DEC_AMT, "Monto $", 75));
                gridColumnsForm.add(new SGridColumnForm(SGridConsts.COL_TYPE_DEC_QTY, "Valor ajustado", 60));
                gridColumnsForm.add(new SGridColumnForm(SGridConsts.COL_TYPE_TEXT_CODE_UNT, "Unidad", 45));
                columnForm = new SGridColumnForm(SGridConsts.COL_TYPE_BOOL_S, "Pago");
                columnForm.setEditable(true);
                gridColumnsForm.add(columnForm);
                gridColumnsForm.add(new SGridColumnForm(SGridConsts.COL_TYPE_TEXT_NAME_CAT_M, "Crédito/préstamo"));
                
                moGridEmployeeRow.getTable().getDefaultEditor(Boolean.class).addCellEditorListener(SDialogPayrollEarnings.this);
                moGridEmployeeRow.getTable().getDefaultEditor(Double.class).addCellEditorListener(SDialogPayrollEarnings.this);
                
                return gridColumnsForm;
            }
        };

        moGridEmployeeRow.setForm(null);
        moGridEmployeeRow.setPaneFormOwner(this);
        jpEmployee.add(moGridEmployeeRow, BorderLayout.CENTER);
        
        reloadCatalogues();
        addAllListeners();
        
        enableFields(false);
    }
    
    private void validateCellEditor() {
        if (moKeyEarning.getSelectedIndex() > 0) {
            if (!moEarnigsMap.get(moKeyEarning.getValue()[0]).areUnitsModifiable()) {
                miClient.showMsgBoxWarning("No se puede modificar el campo 'Valor' para la percepción '" + moEarnigsMap.get(moKeyEarning.getValue()[0]).getName() + "', solo el campo 'Monto $'");
            }
        }
    }
    
    private void enableFields(final boolean enable) {
        moCompValue.getField().setEditable(enable);
        jbAdd.setEnabled(enable);
    }
    
    private void processEdition() {
        itemStateChangedEarning();
        moGridEmployeeRow.renderGridRows();
        moGridEmployeeRow.setSelectedGridRow(0);
    }
    
    private SDbPayrollReceiptEarning createPayrollReceipEarning(final SHrsReceipt hrsReceipt, final SHrsReceiptEarning hrsReceiptEarning, final SHrsEmployeeDays hrsEmployeeDays) {
        double units = 1;
        double amountUnit = 0;
        
        if (hrsReceiptEarning.getEarning().isBasedOnUnits()) {
            units = hrsReceiptEarning.getPayrollReceiptEarning().getUnitsAlleged();
        }
        else {
            amountUnit = hrsReceiptEarning.getPayrollReceiptEarning().getAmountUnitary();
        }

        return hrsReceipt.getHrsPayroll().createPayrollReceiptEarning(
                hrsReceipt, hrsReceiptEarning.getEarning(), hrsEmployeeDays, null, 
                units, amountUnit, false, 
                0, 0, hrsReceiptEarning.getPayrollReceiptEarning().getPkMoveId());
    }
    
    private void initEmployee() {
        for (SGridRow row : moGridEmployeeRow.getModel().getGridRows()) { // process grid
            SHrsReceiptEarning hrsReceiptEarning = (SHrsReceiptEarning) row;
            
            hrsReceiptEarning.setApplying(false);
            
            if (!hrsReceiptEarning.getEarning().isBasedOnUnits()) {
                hrsReceiptEarning.getPayrollReceiptEarning().setAmountUnitary(0);
            }
            else {
                hrsReceiptEarning.getPayrollReceiptEarning().setUnitsAlleged(0);
                hrsReceiptEarning.getPayrollReceiptEarning().setUnits(0);
            }
            
            hrsReceiptEarning.getPayrollReceiptEarning().setAmountSystem_r(0);
            hrsReceiptEarning.getPayrollReceiptEarning().setAmount_r(0);
                
            hrsReceiptEarning.getPayrollReceiptEarning().setFkLoanEmployeeId_n(0);
            hrsReceiptEarning.getPayrollReceiptEarning().setFkLoanLoanId_n(0);
            hrsReceiptEarning.getPayrollReceiptEarning().setFkLoanTypeId_n(0);
        }
    }
    
    private void updateReceiptsEarningRows(final boolean addAll) {
        for (SGridRow row : moGridEmployeeRow.getModel().getGridRows()) { // process grid
            SHrsReceiptEarning hrsReceiptEarning = (SHrsReceiptEarning) row;
            
            hrsReceiptEarning.setEarning(moEarnigsMap.get(hrsReceiptEarning.getRowPrimaryKey()[0]));
            
            for (SHrsReceipt hrsReceipt : maHrsReceipts) { // process receipt
                SHrsEmployeeDays hrsEmployeeDays = hrsReceipt.getHrsEmployee().createEmployeeDays();
                
                if (addAll) {
                    double unitsAlleged = 0;
                    
                    if (moCompValue.getField().isEditable()) {
                        unitsAlleged = moCompValue.getField().getValue();
                    }
                    else {
                        unitsAlleged = 1;
                    }
                    
                    hrsReceiptEarning.getPayrollReceiptEarning().setUnitsAlleged(unitsAlleged);
                    hrsReceiptEarning.getPayrollReceiptEarning().setUnits(hrsEmployeeDays.computeEarningUnits(unitsAlleged, hrsReceiptEarning.getEarning()));
                }
                
                if (hrsReceipt.getHrsEmployee().getEmployee().getPkEmployeeId() == hrsReceiptEarning.getHrsReceipt().getHrsEmployee().getEmployee().getPkEmployeeId()) {
                    boolean found = false;
                    
                    hrsReceiptEarning.setHrsReceipt(hrsReceipt);

                    for (SHrsReceiptEarning hrsReceiptEarningExisting : hrsReceipt.getHrsReceiptEarnings()) { // read array list ear/ded
                        if (SLibUtils.compareKeys(hrsReceiptEarningExisting.getRowPrimaryKey(), hrsReceiptEarning.getRowPrimaryKey())) {  // exists ear/ded
                            found = true;
                            hrsReceiptEarningExisting.setApplying(hrsReceiptEarning.isApplying());
                            
                            if (addAll) {
                                if (!hrsReceiptEarning.getEarning().isBasedOnUnits()) {
                                    hrsReceiptEarningExisting.getPayrollReceiptEarning().setAmountUnitary(hrsReceiptEarning.getPayrollReceiptEarning().getAmountUnitary());
                                }
                                else {
                                    hrsReceiptEarningExisting.getPayrollReceiptEarning().setUnitsAlleged(hrsReceiptEarning.getPayrollReceiptEarning().getUnitsAlleged());
                                    hrsReceiptEarningExisting.getPayrollReceiptEarning().setUnits(hrsReceiptEarning.getPayrollReceiptEarning().getUnits());
                                }
                                
                                double amount = SHrsEmployeeDays.computeEarningAmount(hrsReceiptEarningExisting.getPayrollReceiptEarning().getUnits(), hrsReceiptEarningExisting.getPayrollReceiptEarning().getAmountUnitary(), hrsReceiptEarningExisting.getEarning());
                                hrsReceiptEarningExisting.getPayrollReceiptEarning().setAmountSystem_r(amount);
                                hrsReceiptEarningExisting.getPayrollReceiptEarning().setAmount_r(amount);
                            }

                            hrsReceipt.replaceHrsReceiptEarning(hrsReceiptEarningExisting.getPayrollReceiptEarning().getPkMoveId(), hrsReceiptEarning);

                            if (!hrsReceiptEarningExisting.getPayrollReceiptEarning().isAutomatic() && hrsReceiptEarningExisting.getPayrollReceiptEarning().getUnits() == 0) { 
                                hrsReceipt.removeHrsReceiptEarning(hrsReceiptEarningExisting.getPayrollReceiptEarning().getPkMoveId());
                            }
                            break;
                        }
                    }

                    if (!found) { // not exists
                        if ((hrsReceiptEarning.getEarning().isBasedOnUnits() && hrsReceiptEarning.getPayrollReceiptEarning().getUnitsAlleged() != 0) ||
                                (!hrsReceiptEarning.getEarning().isBasedOnUnits() && (addAll ? hrsReceiptEarning.getPayrollReceiptEarning().getUnitsAlleged() != 0 : hrsReceiptEarning.getPayrollReceiptEarning().getAmountUnitary() != 0))) {  // not is 0 o nulo
                            if (addAll) {
                                hrsReceiptEarning.setPayrollReceiptEarning(createPayrollReceipEarning(hrsReceipt, hrsReceiptEarning, hrsEmployeeDays));
                            }
                            hrsReceipt.addHrsReceiptEarning(hrsReceiptEarning); // add ear/ded to array list
                        }
                    }
                }
            }
        }
    }
    
    private void itemStateChangedEarning() {
        Vector<SGridRow> rows = new Vector<>();
        
        updateReceiptsEarningRows(false);

        /* XXX Sergio Flores, 2019-04-10: Remover este bloque si no se necesita!
        moGridEmployeeRow.getModel().clearGridRows();
        moGridEmployeeRow.getModel().clearGrid();
        */

        if (moKeyEarning.getSelectedIndex() > 0) {
            moCompValue.setCompoundText(moHrsPayroll.getEarningComputationTypesMap().get((int) moKeyEarning.getSelectedItem().getComplement()));
            
            
            for (SHrsReceipt hrsReceipt : maHrsReceipts) { // read receipt
                boolean found = false;
                SHrsEmployeeDays hrsEmployeeDays = hrsReceipt.getHrsEmployee().createEmployeeDays();

                for (SHrsReceiptEarning hrsReceiptEarning : hrsReceipt.getHrsReceiptEarnings()) { // read array list ear/ded
                    if (SLibUtils.compareKeys(hrsReceiptEarning.getHrsReceipt().getHrsEmployee().getEmployee().getPrimaryKey(), hrsReceipt.getHrsEmployee().getEmployee().getPrimaryKey())) {
                        if (SLibUtils.compareKeys(new int[] { hrsReceiptEarning.getEarning().getPkEarningId() }, new int[] { moKeyEarning.getValue()[0] })) {  // exists ear/ded
                            SHrsReceiptEarning hrsReceiptEarningNew = new SHrsReceiptEarning(SHrsReceiptEarning.INPUT_BY_EAR);
                            hrsReceiptEarningNew.setHrsReceipt(hrsReceipt);
                            hrsReceiptEarningNew.setEarning(hrsReceiptEarning.getEarning());
                            hrsReceiptEarningNew.setPayrollReceiptEarning(hrsReceiptEarning.getPayrollReceiptEarning());
                            
                            rows.add(hrsReceiptEarningNew);
                            found = true;
                        }
                    }
                }

                if (!found) {
                    if (!moEarnigsMap.get(moKeyEarning.getValue()[0]).isLoan()) {
                        SHrsReceiptEarning hrsReceiptEarningNew = new SHrsReceiptEarning(SHrsReceiptEarning.INPUT_BY_EAR);
                        hrsReceiptEarningNew.setHrsReceipt(hrsReceipt);
                        hrsReceiptEarningNew.setEarning(moEarnigsMap.get(moKeyEarning.getValue()[0]));
                        hrsReceiptEarningNew.setPayrollReceiptEarning(createPayrollReceipEarning(hrsReceipt, hrsReceiptEarningNew, hrsEmployeeDays));

                        rows.add(hrsReceiptEarningNew);
                    }
                }
            }
        }
        
        enableFields(!rows.isEmpty() && !moEarnigsMap.get(moKeyEarning.getValue()[0]).isBasedOnDaysWorked());
        
        moGridEmployeeRow.populateGrid(rows);
        moGridEmployeeRow.clearSortKeys();
        moGridEmployeeRow.setSelectedGridRow(0);
    }
    
    private void actionAdd() {
        if (moCompValue.getField().getValue() <= 0) {
            miClient.showMsgBoxWarning(SGuiConsts.ERR_MSG_FIELD_DIF + "'" + SGuiUtils.getLabelName(jlValue) + "'.");
            moCompValue.getField().getComponent().requestFocus();
        }
        else {
            updateReceiptsEarningRows(true);
            itemStateChangedEarning();
            moCompValue.getField().setValue(0);            
        }
    }
    
    public void actionClean() {
        if (jbClean.isEnabled()) {
            if (moGridEmployeeRow.getTable().getSelectedRowCount() == 1) {
                SHrsReceiptEarning hrsReceiptEarning = (SHrsReceiptEarning) moGridEmployeeRow.getSelectedGridRow();
                
                hrsReceiptEarning.setApplying(false);
                if (!hrsReceiptEarning.getEarning().isBasedOnUnits()) {
                    hrsReceiptEarning.getPayrollReceiptEarning().setAmountUnitary(0);
                }
                else {
                    hrsReceiptEarning.getPayrollReceiptEarning().setUnitsAlleged(0);
                    hrsReceiptEarning.getPayrollReceiptEarning().setUnits(0);
                }
                hrsReceiptEarning.getPayrollReceiptEarning().setAmountSystem_r(0);
                hrsReceiptEarning.getPayrollReceiptEarning().setAmount_r(0);
                
                hrsReceiptEarning.getPayrollReceiptEarning().setFkLoanEmployeeId_n(0);
                hrsReceiptEarning.getPayrollReceiptEarning().setFkLoanLoanId_n(0);
                hrsReceiptEarning.getPayrollReceiptEarning().setFkLoanTypeId_n(0);
                
                moGridEmployeeRow.renderGridRows();
                moGridEmployeeRow.setSelectedGridRow(moGridEmployeeRow.getModel().getGridRows().indexOf(hrsReceiptEarning));
            }
        }
    }

    public void actionCleanAll() {
        if (jbCleanAll.isEnabled()) {
            if (moGridEmployeeRow.getTable().getRowCount() > 0) {
                if (miClient.showMsgBoxConfirm("¿Está seguro que desea limpiar todas las capturas?") == JOptionPane.YES_OPTION) {
                    initEmployee();

                    moGridEmployeeRow.renderGridRows();
                    moGridEmployeeRow.getTable().requestFocus();
                    moGridEmployeeRow.setSelectedGridRow(0);
                }
            }
        }
    }
    
    private void populateEarnings(ArrayList<SDbEarning> earnings) {
        Vector<SGuiItem> items = new Vector<>();
        
        try {
            items.add(new SGuiItem(new int[] { 0 }, "- Percepción -"));
            
            for (SDbEarning earning : earnings) {
                if (!earning.isBenefit() && !earning.isAbsence()) {
                    items.add(new SGuiItem(earning.getPrimaryKey(), (earning.getCode() + " - " + earning.getName()), earning.getFkEarningComputationTypeId()));
                }
            }
            
            moKeyEarning.removeAllItems();
            for (SGuiItem item : items) {
                moKeyEarning.addItem(item);
            }
        }
        catch (Exception e) {
            SLibUtils.showException(this, e);
        }
    }
    
    @Override
    public void addAllListeners() {
        moKeyEarning.addItemListener(this);
        jbAdd.addActionListener(this);
        jbClean.addActionListener(this);
        jbCleanAll.addActionListener(this);
    }

    @Override
    public void removeAllListeners() {
        moKeyEarning.removeItemListener(this);
        jbAdd.removeActionListener(this);
        jbClean.removeActionListener(this);
        jbCleanAll.removeActionListener(this);
    }

    @Override
    public void reloadCatalogues() {
        
    }

    @Override
    public void setRegistry(SDbRegistry registry) throws Exception {
        throw new UnsupportedOperationException("Not supported yet.");
    }

    @Override
    public SDbRegistry getRegistry() throws Exception {
        throw new UnsupportedOperationException("Not supported yet.");
    }

    @Override
    public SGuiValidation validateForm() {
        SGuiValidation validation = moFields.validateFields();
        
        return validation;
    }

    @Override
    public void setValue(final int type, final Object value) {
        try {
            switch (type) {
                case SModConsts.HRS_PAY:
                    moHrsPayroll = (SHrsPayroll) value;
                    populateEarnings(moHrsPayroll.getEarnigs());

                    moEarnigsMap = new HashMap<>();
                    for (SDbEarning earning : moHrsPayroll.getEarnigs()) {
                        moEarnigsMap.put(earning.getPkEarningId(), earning);
                    }
                    break;
                    
                case SModConsts.HRS_PAY_RCP:
                    maHrsReceipts = (ArrayList<SHrsReceipt>) value;
                    break;
                    
                default:
            }
        }
        catch (Exception e ) {
            SLibUtils.printException(this, e);
        }
    }

    @Override
    public Object getValue(final int type) {
        Object value = null;
        
        switch (type) {
            case SModConsts.HRS_PAY_RCP:
                value = maHrsReceipts;
                break;
            default:
        }

        return value;
    }
    
    @Override
    public void actionSave() {
        updateReceiptsEarningRows(false);
        super.actionSave();
    }

    @Override
    public void notifyRowNew(int gridType, int gridSubtype, int row, SGridRow gridRow) {
        throw new UnsupportedOperationException("Not supported yet.");
    }

    @Override
    public void notifyRowEdit(int gridType, int gridSubtype, int row, SGridRow gridRow) {
        throw new UnsupportedOperationException("Not supported yet.");
    }

    @Override
    public void notifyRowDelete(int gridType, int gridSubtype, int row, SGridRow gridRow) {
        throw new UnsupportedOperationException("Not supported yet.");
    }

    @Override
    public void actionPerformed(ActionEvent e) {
        if (e.getSource() instanceof JButton) {
            JButton button = (JButton) e.getSource();

            if (button == jbAdd) {
                actionAdd();
            }
            else if (button == jbClean) {
                actionClean();
            }
            else if (button == jbCleanAll) {
                actionCleanAll();
            }
        }
    }

    @Override
    public void itemStateChanged(ItemEvent e) {
        if (e.getSource() instanceof JComboBox && e.getStateChange() == ItemEvent.SELECTED) {
            JComboBox comboBox = (JComboBox)  e.getSource();

            if (comboBox == moKeyEarning) {
                itemStateChangedEarning();
            }
        }
    }

    @Override
    public void editingStopped(ChangeEvent e) {
        switch (moGridEmployeeRow.getTable().getSelectedColumn()) {
            case COL_UNITS_ALLEGED:
                validateCellEditor();
                processEdition();
                break;
            case COL_AMOUNT:
            case COL_SET_FLAG:
                processEdition();
                break;
            default:
        }
    }

    @Override
    public void editingCanceled(ChangeEvent e) {
        
    }
}
